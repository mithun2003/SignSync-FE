<header class="flex justify-center py-4 fixed w-full z-[100]">
  <div
    class="
    block
    w-3/4
    bg-white/10 rounded-4xl shadow-nav-bar border border-white/20 backdrop-blur-md
    px-4
    py-2
    lg:flex lg:items-center lg:justify-between
  ">
    <div class="flex justify-between items-center w-full lg:w-auto">
      <a routerLink="/home" class="flex items-center">
        <img ngSrc="images/icon.png" width="40" height="40" alt="SignSync Logo" class="logo" />
        <span class="ml-1 font-bold text-white text-lg">SignSync</span>
      </a>

      <button (click)="toggleMenu()" class="block bg-transparent lg:hidden border-none cursor-pointer p-1">
        @if (!isMenuOpen()) {
          <svg class="text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"></path>
          </svg>
        } @else {
          <svg class="text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="m16.192 6.344-4.243 4.242-4.242-4.242-1.414 1.414L10.535 12l-4.242 4.242 1.414 1.414 4.242-4.242 4.243 4.242 1.414-1.414L13.364 12l4.242-4.242z"></path>
          </svg>
        }
      </button>
    </div>

    <div
      #linksDiv
      id="navigation"
      [style.height]="isMenuOpen() ? (linksDiv.scrollHeight + 'px') : (isLargeScreen() ? 'auto' : '0')"
      class="
      basis-full lg:basis-auto
      flex
      flex-col
      items-center
      gap-4
      w-full
      overflow-hidden
      text-white
      transition-all
      duration-500
      ease-in-out
      lg:h-auto lg:flex-row lg:overflow-visible lg:justify-between lg:w-3/4"
      [class.mt-4]="isMenuOpen() && !isLargeScreen()"
    >

      @for (link of navLinks; track link.routerLink) {
      <a
        [routerLink]="link.routerLink"
        [routerLinkActiveOptions]="{ exact: true }"
        routerLinkActive="[&_div]:w-full"
        class="nav-link text-white group p-2 px-4 lg:w-auto text-center"
        (click)="closeMobileMenu()">
        {{ link.title }}
        <div class="bg-white h-0.5 w-0 group-hover:w-full transition-all duration-500 ease-in-out"></div>
      </a>
      }

      <div class="flex items-center gap-4 py-2 lg:py-0">
        @if(commonService.loading()) {
        <div class="relative group overflow-hidden flex items-center justify-center gap-3 p-2 rounded-lg border border-border-primary transition-colors user-menu-button">
          <fa-icon size="xl" [icon]="faSpinner" class="text-base text-white animate-spin [animation-duration:1.8s]"></fa-icon>
        </div>
        }
        @else if (isLoggedIn()) {
        <div class="relative">
          <button (click)="toggleUserMenu($event)"
            class="relative group overflow-hidden flex items-center justify-center gap-3 p-2 rounded-lg border border-border-primary transition-colors user-menu-button cursor-pointer"
            aria-label="User menu">
            <span class="hover-effect bg-white/10"></span>
            <img
              [src]="user()?.profile_photo || 'https://static.vecteezy.com/system/resources/thumbnails/009/292/244/small/default-avatar-icon-of-social-media-user-vector.jpg'"
              class="w-9 h-9 rounded-full border border-white/20"
              alt="User Avatar" />
            <div class="block md:block text-left">
              <p class="text-sm font-medium text-white">{{ user()?.username || 'Admin User' }}</p>
              <p class="text-xs text-white/60">{{ user()?.email || 'admin@example.com' }}</p>
            </div>
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          @if (showUserMenu()) {
          <div class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-[110] user-menu-dropdown overflow-hidden">
            <div class="p-4 border-b border-gray-200 bg-gray-50">
              <p class="text-sm font-medium text-gray-900">{{ user()?.username }}</p>
              <p class="text-xs text-gray-500">{{ user()?.email }}</p>
            </div>
            <div class="py-1">
              <a routerLink="/profile" class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">Profile</a>
              <a routerLink="/settings" class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">Settings</a>
              <a routerLink="/help" class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">Help & Support</a>
            </div>
            <div class="border-t border-gray-200 bg-red-50">
              <button (click)="logout()" class="flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-100 transition-colors w-full text-left cursor-pointer">
                Sign out
              </button>
            </div>
          </div>
        }
        </div>
          
        } @else {
        <app-common-button
          text="Login"
          buttonClass="common-login-button body-3-medium"
          routerLink="/auth/signin">
        </app-common-button>
        }
      </div>
    </div>
  </div>
</header>